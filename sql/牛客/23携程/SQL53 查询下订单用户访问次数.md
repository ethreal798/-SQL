## ***\*SQL53 查询下订单用户访问次数？ （技巧 需要多表关联查询，且某表中需要剔除部分数据  可以考虑子查询先行提取数据再进行关联查询）\****

### 做什么

请查询2022年9月2日这天下订单的用户的访问次数？

要求输出：user_id,访问次数

注：访问次数定义为用户在该日"访问-离开"则记录1次，输出结果按照访问次数降序排序

示例数据结果如下：

| user_id | visit_nums |
| ------- | ---------- |
| 11      | 2          |
| 12      | 1          |

结果解释：

2022年9月2日这天user_id为11、12的用户下了订单，

其中11用户分别在10:30-11:05及12:00-12:02访问，故访问次数为2次，

12用户在11:40-13:15访问，故访问次数为1次。

### 怎么做

- 题目让我们查询2022年9月2日这一天下单的用户，从结果中得知 分别是11 12 但下单表中有三条下单记录  所以需要筛掉部分行   使用distinct 或者 子查询
- 结果数据的第二个字段是访问次数，在第二个表中  只要两表关联根据条件匹配即可
- 结合字段2需要关联查询可知 使用子查询更有利于查出对应结果
- 时间判断 我们使用date(time) = '2022-09-02'

### 代码展示

```
select 
    u.user_id , count(v.user_id) visit_nums
from (
    select
        distinct user_id
    from order_tb 
    where date(order_time) = '2022-09-02'
)u
join visit_tb v
on u.user_id = v.user_id
where date(v.visit_time) = '2022-09-02' and date(v.leave_time) = '2022-09-02'
group by u.user_id
order by visit_nums desc
```